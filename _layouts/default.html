<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{{ page.title }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="{{site.baseurl}}/css/application.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body class="{{page.house | downcase}}">
      <div class="header">
        <div class="container">
          <ul class="nav nav-pills pull-right" role="tablist">
            <li role="presentation"><a class="commons-bg" href="{{site.baseurl}}/commons.html">House of Commons</a></li>
            <li role="presentation"><a class="lords-bg" href="{{site.baseurl}}/lords.html">House of Lords</a></li>
          </ul>
          <h2 class="text-muted"><a href="{{site.baseurl}}/">{{ site.name }}</a></h2>
        </div>
      </div>

      <div class="page-header">
        <div class="container">
          <h1>{{ page.title }}</h1>
        </div>
      </div>

      <div class="container">

        {{ content }}

      </div> <!-- /container -->

      <footer class="footer">
        <div class="container">
          <p>
            <a href="https://github.com/JeniT/childs-guide-to-parliament"><img src="{{site.baseurl}}/assets/images/GitHub-Mark-32px.png"></a>
            <a href="https://twitter.com/JeniT"><img height="32px" src="{{site.baseurl}}/assets/images/Twitter_logo_blue.png"></a>
          </p>
        </div>
      </footer>

      <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <!-- Include all compiled plugins (below), or include individual files as needed -->
      <script src="{{site.baseurl}}/assets/javascripts/bootstrap.js"></script>
      <script src="{{site.baseurl}}/assets/javascripts/application.js"></script>
      <script src="http://d3js.org/d3.v3.min.js"></script>
      <script src="http://d3js.org/queue.v1.min.js"></script>

      {% if page.footer-js == 'force-visualisation' %}
      <script>

        /* Set the diagrams Height & Width */
            var h = 500, w = 950;
        /* Set the color scale we want to use */
            var color = d3.scale.category20();
        /* Establish/instantiate an SVG container object */
            var svg = d3.select("body")
                            .append("svg")
                            .attr("height",h)
                            .attr("width",w);
        /* Build the directional arrows for the links/edges */
                svg.append("svg:defs")
                            .selectAll("marker")
                            .data(["end"])
                            .enter().append("svg:marker")
                            .attr("id", String)
                            .attr("viewBox", "0 -5 10 10")
                            .attr("refX", 15)
                            .attr("refY", -1.5)
                            .attr("markerWidth", 6)
                            .attr("markerHeight", 6)
                            .attr("orient", "auto")
                            .append("svg:path")
                            .attr("d", "M0,-5L10,0L0,5");
        /* Pre-Load the json data using the queue library */
        queue()
            .defer(d3.json, "data/members/all.json")
            .defer(d3.json, "data/members/shared_interest_links.json")
            .await(makeDiag);
        /* Define the main worker or execution function */
        function makeDiag(error, nodes, links, table) {
            /* Draw the node labels first */
           var texts = svg.selectAll("text")
                            .data(nodes)
                            .enter()
                            .append("text")
                            .attr("fill", "black")
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "10px")
                            .text(function(d) { return d.name; });
            /* Establish the dynamic force behavor of the nodes */
            var force = d3.layout.force()
                            .nodes(nodes)
                            .links(links)
                            .size([w,h])
                            .start();
            /* Draw the edges/links between the nodes */
            var edges = svg.selectAll("line")
                            .data(links)
                            .enter()
                            .append("line")
                            .style("stroke", "#ccc")
                            .style("stroke-width", 1);
            /* Draw the nodes themselves */
            var nodes = svg.selectAll("circle")
                            .data(nodes)
                            .enter()
                            .append("circle")
                            .attr("r", 20)
                            .attr("opacity", 0.5)
                            .style("fill", function(d,i) { return color(i); })
                            .call(force.drag);
            /* Run the Force effect */
            force.on("tick", function() {
                       edges.attr("x1", function(d) { return d.source.x; })
                            .attr("y1", function(d) { return d.source.y; })
                            .attr("x2", function(d) { return d.target.x; })
                            .attr("y2", function(d) { return d.target.y; });
                       nodes.attr("cx", function(d) { return d.x; })
                            .attr("cy", function(d) { return d.y; })
                       texts.attr("transform", function(d) {
                                return "translate(" + d.x + "," + d.y + ")";
                                });
                       }); // End tick func
        }; // End makeDiag worker func
        </script>
      {% endif %}
    </body>
</html>
